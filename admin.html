<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Isnpro Market - Pusat Top Up & Jual Beli Game Murah" />
    <meta property="og:description" content="Solusi aman dan terpercaya untuk kebutuhan game dan topup. Harga pelajar, proses cepat, dan amanah!" />
    <meta property="og:image" content="https://api.deline.web.id/uhxRrZLShb.jpg" />
    <meta property="og:type" content="website" />
    <title>Isnpro Market Profile</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="star-container"></div>
    <div id="sidebar-overlay"></div>

    <nav id="sidebar">
        <div class="sidebar-header-profile">
            <img src="https://api.deline.web.id/uhxRrZLShb.jpg" alt="Profile" class="sidebar-profile-pic-large">
            <h4 class="sidebar-market-name">ISNPRO MARKET</h4>
            <button id="btn-sidebar-info" class="btn-sidebar-info">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                Info
            </button>
        </div>
        <div class="sidebar-label">KATEGORI PRODUK</div>
        <ul class="sidebar-menu-list">
             <li>
                <a href="#" data-page="sewa_bot"> 
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Sewa bot</span>
                    </div>
                    <span id="count-sewa_bot" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="script_bot"> 
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Script bot</span>
                    </div>
                    <span id="count-script_bot" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="topup_game">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Diamond Free Fire</span>
                    </div>
                    <span id="count-topup_game" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="topup_game1">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Diamond Mobile Legend</span>
                    </div>
                    <span id="count-topup_game1" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="topup_game2">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Robux Roblox</span>
                    </div>
                    <span id="count-topup_game2" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="gamepass">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Gamepass Roblox</span>
                    </div>
                    <span id="count-gamepass" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="acc_allgame">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Akun Allgame</span>
                    </div>
                    <span id="count-acc_allgame" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="joki_allgame">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Joki Allgame</span>
                    </div>
                    <span id="count-joki_allgame" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="apk_premium">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Apk Premium</span>
                    </div>
                    <span id="count-apk_premium" class="category-count">[ 0 ]</span>
                </a>
            </li>
            <li>
            <a href="#" data-page="campuran">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Icon" class="store-profile-pic">
                        <span>Produk Campuran</span>
                    </div>
                    <span id="count-campuran" class="category-count">[ 0 ]</span>
                </a>
            </li>
        </ul>
        <ul class="sidebar-footer-menu">
            <li><a href="#" id="btn-home-l1">Kembali halaman utama</a></li>
            <li><a href="#" id="btn-exit-l1">Keluar dari website</a></li>
        </ul>
        <div class="sidebar-copyright">© 2025 Isnpro Market. All rights reserved.</div>
    </nav>
    
    <div class="navbar" id="navbar">
        <div class="hamburger-menu">
            <div class="line"></div><div class="line"></div><div class="line"></div>
        </div>
        <div class="nav-title" id="navTitle" style="cursor: pointer;">WEBSITE MARKETPLACE</div>
        <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Profil" class="nav-profile-pic" id="navbarProfilePic">
    </div>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content-container">
            <div class="loading-spinner"></div>
            <img src="https://api.deline.web.id/ltSnd8k2WI.jpg" alt="Loading" class="loading-profile-pic">
        </div>
        <div id="loadingText" class="loading-text">loading</div>
    </div>

    <div id="halamanBaru" class="halaman-baru">
        <div id="default-content">
            <h2 style="font-size: 2rem; margin-bottom:10px; color: #00f2ff; text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);">Welcome to Website Isnpro</h2>
            <img src="https://api.deline.web.id/7JLp3oMozM.jpg" alt="Banner" class="welcome-image">
            <p style="margin-top: 15px;">Klik <b>garis tiga</b> (menu) untuk melihat kategori produk.</p>
             <div class="info-section">
                <h3 class="content-subheading">Kenapa beli di sini?</h3>
                <p class="info-text">1. Amanah & Terpercaya<br>2. Fast Respons<br>3. Harga Termurah</p>
            </div>
            <div class="info-section">
                <h3 class="content-subheading">Cara Memesan</h3>
                <p class="info-text">1. Buka Menu (Kiri Atas)<br>2. Pilih Kategori & Produk<br>3. Checkout Sekarang</p>
            </div>
        </div>

        <div id="sewa_bot-content" class="page-content"><h2 class="page-title">Halaman Sewa Bot</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari paket..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="topup_game-content" class="page-content"><h2 class="page-title">Halaman Diamond Free Fire</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari diamond..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="topup_game1-content" class="page-content"><h2 class="page-title">Halaman Diamond Mobile Legend</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari diamond..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="topup_game2-content" class="page-content"><h2 class="page-title">Halaman Robux Roblox [vilog]</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari robux..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="gamepass-content" class="page-content"><h2 class="page-title">Halaman Gamepass Roblox</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari gamepass..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="script_bot-content" class="page-content"><h2 class="page-title">Halaman Script Bot</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari script..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="acc_allgame-content" class="page-content"><h2 class="page-title">Jual Akun Allgame</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari akun..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="joki_allgame-content" class="page-content"><h2 class="page-title">Jasa Joki Allgame</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari joki..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div> 
        <div id="apk_premium-content" class="page-content"><h2 class="page-title">Aplikasi Premium</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari aplikasi..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>
        <div id="campuran-content" class="page-content"><h2 class="page-title">Produk Campuran</h2><div class="search-wrapper"><input type="text" class="search-input" placeholder="Cari produk..."></div><hr class="page-divider"><div class="product-grid-placeholder"></div></div>

        <footer class="global-footer">© 2025 Isnpro Market. All rights reserved.</footer>
    </div>

    <div id="productModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="slider-container">
                <button class="slider-btn prev-btn" onclick="moveSlide(-1)">&#10094;</button>
                <div id="modalImagesWrapper"></div>
                <button class="slider-btn next-btn" onclick="moveSlide(1)">&#10095;</button>
            </div>
            <div id="modalDetails">
                <h3 class="modal-title" id="mTitle">Nama Produk</h3>
                <div class="modal-price" id="mPrice">Rp 0</div>
                <div class="modal-desc" id="mDesc">Deskripsi...</div>
                <div class="modal-actions" id="modalActions"></div>
            </div>
        </div>
    </div>

    <div id="fullscreenImageOverlay" class="fullscreen-overlay">
        <span class="close-fullscreen">&times;</span>
        <button class="fullscreen-btn prev" onclick="moveFullscreenSlide(-1)">&#10094;</button>
        <img src="" alt="Fullscreen Image" id="fullscreenImgDisplay">
        <button class="fullscreen-btn next" onclick="moveFullscreenSlide(1)">&#10095;</button>
    </div>

    <div id="infoModal" class="modal-overlay">
        <div class="modal-content modal-white-theme">
            <span class="close-modal text-dark" onclick="closeInfoModal()">&times;</span>
            <div class="info-header">
                <img src="https://api.deline.web.id/uhxRrZLShb.jpg" alt="Isnpro" class="info-modal-img">
                <h3 class="modal-title title-dark">ISNPRO MARKET</h3>
                <p class="info-subtitle">Trusted Marketplace & Store</p>
            </div>
            <p class="info-desc-text">Website resmi Isnpro. Solusi aman dan terpercaya untuk kebutuhan game dan topup.</p>
            </div>
    </div>

    <div id="announcementOverlay" class="announcement-overlay">
        <div class="announcement-box">
            <div class="close-announcement" onclick="closeAnnouncement()">&times;</div>
            <img src="https://api.deline.web.id/7JLp3oMozM.jpg" alt="Banner" class="announcement-banner">
            <div class="announcement-content">
                <h3 class="announcement-title">INFORMASI PENTING</h3>
                <div id="announcementList" class="announcement-list">
                    </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, orderBy, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBq7KGW5JMF6CwsIfx49vfL2K--B8RO-pQ",
            authDomain: "website-jb-24a86.firebaseapp.com",
            projectId: "website-jb-24a86",
            storageBucket: "website-jb-24a86.firebasestorage.app",
            messagingSenderId: "548884046832",
            appId: "1:548884046832:web:a2a3507c3f6935659ff335"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- VARIABEL UI ---
        const navbar = document.getElementById('navbar');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const hamburger = document.querySelector('.hamburger-menu');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');
        const halamanBaru = document.getElementById('halamanBaru');
        const defaultContent = document.getElementById('default-content');
        const allPageContent = document.querySelectorAll('.page-content');
        const productModal = document.getElementById('productModal');
        const modalImagesWrapper = document.getElementById('modalImagesWrapper'); 
        const prevBtn = document.querySelector('.slider-btn.prev-btn');
        const nextBtn = document.querySelector('.slider-btn.next-btn');
        const modalActions = document.getElementById('modalActions');
        
        // Fullscreen vars
        const fullscreenOverlay = document.getElementById('fullscreenImageOverlay');
        const fullscreenImgDisplay = document.getElementById('fullscreenImgDisplay');
        const closeFullscreenBtn = document.querySelector('.close-fullscreen');
        
        let textInterval;
        let currentSlideIndex = 0;
        let currentModalImages = [];
        let currentFullscreenIndex = 0; 
        
        // Data Category
        const categoryMap = {
            'sewa_bot': 'Halaman Sewa Bot', 
            'topup_game': 'Halaman Diamond Free Fire', 
            'topup_game1': 'Halaman Diamond Mobile Legend', 
            'topup_game2': 'Halaman Robux Roblox [vilog]', 
            'gamepass': 'Halaman Gamepass Roblox', 
            'script_bot': 'Halaman Script Bot',
            'acc_allgame': 'Halaman Jual Akun', 
            'joki_allgame': 'Halaman Joki Akun',
            'apk_premium': 'Aplikasi Premium',
            'campuran': 'Halaman Produk Campuran'
        };

        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
        }

        // --- NAVIGATION LOGIC ---
        hamburger.addEventListener('click', () => {
            requestAnimationFrame(() => {
                sidebar.classList.add('show');
                sidebarOverlay.style.display = 'block';
                setTimeout(() => { sidebarOverlay.style.opacity = '1'; }, 10);
            });
        });

        window.closeAllSidebars = function() {
            sidebar.classList.remove('show');
            sidebarOverlay.style.opacity = '0';
            setTimeout(() => {
                if(!sidebar.classList.contains('show')) {
                    sidebarOverlay.style.display = 'none';
                }
            }, 300);
        }

        sidebarOverlay.addEventListener('click', closeAllSidebars);

        document.querySelectorAll('.sidebar-menu-list a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                let target = e.currentTarget;
                document.querySelectorAll('.sidebar-menu-list a').forEach(l => l.classList.remove('active'));
                target.classList.add('active');

                const pageId = target.dataset.page;
                setTimeout(() => {
                    closeAllSidebars();
                    if(pageId) showPage(pageId);
                }, 150);
            });
        });
        
        // --- BUTTON HANDLERS ---
        document.getElementById('btn-home-l1').addEventListener('click', (e) => { e.preventDefault(); closeAllSidebars(); startLoading(); });
        document.getElementById('btn-exit-l1').addEventListener('click', (e) => { e.preventDefault(); if(confirm("Keluar dari website?")) history.back(); });
        
        // --- SIDEBAR COUNTER ---
        async function updateSidebarCounts() {
            try {
                const q = query(collection(db, "products"));
                const snapshot = await getDocs(q);
                const counts = {};
                snapshot.forEach(doc => {
                    const d = doc.data();
                    counts[d.category] = (counts[d.category] || 0) + 1;
                });
                for (const [key, value] of Object.entries(categoryMap)) {
                     const badge = document.getElementById(`count-${key}`);
                     if(badge) badge.innerText = `[ ${counts[key] || 0} ]`;
                }
            } catch (e) { console.error("Count err:", e); }
        }

        // --- FETCH PRODUCTS ---
        let activeCategoryId = ''; 
        let currentProductsData = [];

        async function loadProducts(categoryId) {
            activeCategoryId = categoryId; 
            currentProductsData = []; 
            const container = document.querySelector(`#${categoryId}-content .product-grid-placeholder`);
            const searchInput = document.querySelector(`#${categoryId}-content .search-input`);

            if (!container) return;
            container.innerHTML = '<div class="empty-slot" style="color:#aaa;text-align:center; grid-column: 1/-1;">Memuat produk...</div>';

            if(searchInput) {
                searchInput.value = '';
                const newSearchInput = searchInput.cloneNode(true);
                searchInput.parentNode.replaceChild(newSearchInput, searchInput);
                newSearchInput.addEventListener('input', (e) => handleSearch(e.target.value));
            }

            try {
                const q = query(collection(db, "products"), where("category", "==", categoryId), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    container.innerHTML = '<div class="empty-slot" style="color:#aaa;text-align:center; grid-column: 1/-1;">Belum ada produk.</div>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    currentProductsData.push({ id: doc.id, ...doc.data() });
                });
                renderProducts(currentProductsData, container);
            } catch (error) {
                console.error("Error:", error);
                container.innerHTML = '<div class="empty-slot" style="color:red;text-align:center; grid-column: 1/-1;">Gagal memuat data.</div>';
            }
        }

        function handleSearch(keyword) {
            const container = document.querySelector(`#${activeCategoryId}-content .product-grid-placeholder`);
            if(!container) return;
            const lowerKeyword = keyword.toLowerCase();
            const filteredProducts = currentProductsData.filter(item => {
                return item.name.toLowerCase().includes(lowerKeyword) || item.description.toLowerCase().includes(lowerKeyword);
            });
            if (filteredProducts.length > 0) renderProducts(filteredProducts, container);
            else container.innerHTML = '<div class="empty-slot" style="color:#aaa;text-align:center; grid-column: 1/-1;">Produk tidak ditemukan.</div>';
        }

        function renderProducts(productList, container) {
            container.innerHTML = ''; 
            productList.forEach((data) => {
                const priceFormatted = formatRupiah(data.price);
                const isOff = data.status === 'off';
                const badgeClass = isOff ? 'status-off' : 'status-stock';
                const badgeText = isOff ? 'OFF STOCK' : 'STOCK';
                const btnClass = isOff ? 'btn-info btn-habis' : 'btn-info';
                
                const card = document.createElement('div');
                card.className = `product-card ${isOff ? 'is-off' : ''}`;
                card.innerHTML = `
                    <div class="status-badge ${badgeClass}">${badgeText}</div>
                    <img src="${data.images[0]}" alt="${data.name}" class="card-img">
                    <div class="card-title">${data.name}</div>
                    <div class="card-price">${priceFormatted}</div>
                    <div class="card-desc-short">${data.description.substring(0, 50)}...</div>
                    <button class="${btnClass}" ${isOff ? 'disabled' : ''}>${isOff ? 'HABIS' : 'BELI'}</button>
                `;
                if(!isOff) {
                    card.querySelector('.btn-info').addEventListener('click', () => openModal(data));
                    card.querySelector('.card-img').addEventListener('click', () => openModal(data));
                }
                container.appendChild(card);
            });
        }

        // --- FULLSCREEN & MODAL LOGIC (Disalin ulang agar tidak hilang) ---
        window.openFullscreen = function(index) {
            currentFullscreenIndex = index;
            fullscreenImgDisplay.src = currentModalImages[currentFullscreenIndex];
            fullscreenOverlay.style.display = 'flex';
        }
        window.moveFullscreenSlide = function(n) {
             if (currentModalImages.length <= 1) return;
             currentFullscreenIndex += n;
             if (currentFullscreenIndex >= currentModalImages.length) currentFullscreenIndex = 0;
             if (currentFullscreenIndex < 0) currentFullscreenIndex = currentModalImages.length - 1;
             fullscreenImgDisplay.src = currentModalImages[currentFullscreenIndex];
        }
        closeFullscreenBtn.addEventListener('click', () => { fullscreenOverlay.style.display = 'none'; });

        window.openModal = function(data) {
            currentModalImages = data.images;
            currentSlideIndex = 0;
            document.getElementById('mTitle').innerText = data.name;
            document.getElementById('mPrice').innerText = formatRupiah(data.price);
            document.getElementById('mDesc').innerText = data.description;
            
            modalImagesWrapper.innerHTML = '';
            data.images.forEach((imgUrl, index) => {
                const img = document.createElement('img');
                img.src = imgUrl; img.className = `slider-img ${index === 0 ? 'active' : ''}`;
                img.onclick = function() { openFullscreen(index); };
                modalImagesWrapper.appendChild(img);
            });
            
            const hasMultiple = data.images.length > 1;
            prevBtn.style.display = hasMultiple ? 'flex' : 'none';
            nextBtn.style.display = hasMultiple ? 'flex' : 'none';
            
            // Logic Tombol Beli (Direct/Rekber)
            modalActions.innerHTML = '';
            let rawWa = data.whatsapp.toString().replace(/\D/g, '');
            if (rawWa.startsWith('0')) rawWa = '62' + rawWa.substring(1);
            
            const ownerNumber = "628988685425"; 
            const textSeller = encodeURIComponent(`Halo, saya ingin membeli ${data.name}. Masih ada?`);
            
            const btnDirect = document.createElement('button');
            btnDirect.className = 'btn-modal btn-direct';
            btnDirect.innerText = "BELI SEKARANG (WHATSAPP)";
            btnDirect.onclick = () => window.open(`https://wa.me/${rawWa}?text=${textSeller}`, '_blank');
            modalActions.appendChild(btnDirect);

            productModal.style.display = 'flex';
        };
        window.closeModal = function() { productModal.style.display = 'none'; };
        window.moveSlide = function(n) {
             if (currentModalImages.length <= 1) return;
             const images = document.querySelectorAll('.slider-img');
             images[currentSlideIndex].classList.remove('active');
             currentSlideIndex = (currentSlideIndex + n + images.length) % images.length;
             images[currentSlideIndex].classList.add('active');
        }

        // --- PAGE SHOW ---
        function showPage(pageId) {
            loadingOverlay.style.display = 'none';
            halamanBaru.style.display = 'block';
            navbar.classList.add('show');
            defaultContent.style.display = 'none';
            allPageContent.forEach(el => el.style.display = 'none');

            const targetElement = document.getElementById(pageId + '-content');
            if (targetElement) {
                targetElement.style.display = 'block';
                loadProducts(pageId);
            } else {
                defaultContent.style.display = 'block';
            }
        }
        function startLoading() {
            loadingOverlay.style.display = 'flex'; 
            let dots=0; textInterval = setInterval(() => { dots=(dots+1)%4; loadingText.innerText='loading'+'.'.repeat(dots); }, 500);
            setTimeout(() => {
                loadingOverlay.style.display = 'none'; clearInterval(textInterval);
                showPage('default');
            }, 1500);
        }

        // --- ANNOUNCEMENT LOGIC (BARU) ---
        window.closeAnnouncement = function() {
            document.getElementById('announcementOverlay').style.display = 'none';
        }

        async function checkAnnouncement() {
            // Cek apakah sudah dilihat di sesi ini?
            if(sessionStorage.getItem('announcementSeen')) return;

            try {
                const docRef = doc(db, "settings", "announcement");
                const docSnap = await getDoc(docRef);

                if(docSnap.exists()) {
                    const data = docSnap.data();
                    const now = Date.now();

                    // Cek apakah belum kadaluarsa
                    if(data.expiresAt && now < data.expiresAt) {
                        const listContainer = document.getElementById('announcementList');
                        listContainer.innerHTML = '';
                        
                        data.lines.forEach(text => {
                            const item = document.createElement('div');
                            item.className = 'announcement-item';
                            item.innerText = text;
                            listContainer.appendChild(item);
                        });

                        document.getElementById('announcementOverlay').style.display = 'flex';
                        
                        // Tandai sudah dilihat sesi ini
                        sessionStorage.setItem('announcementSeen', 'true');
                    } else {
                        // Jika kadaluarsa, jangan tampilkan (bisa opsional hapus doc di server via admin logic saja)
                    }
                }
            } catch (e) {
                console.log("No announcement or error:", e);
            }
        }

        // --- MAIN ---
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const page = params.get('page'); 
            updateSidebarCounts();
            
            // Cek pengumuman
            checkAnnouncement();

            if (page) showPage(page); else startLoading();
        });
    </script>
</body>
</html>
